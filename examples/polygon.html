<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"/>

    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>

    <link rel="stylesheet" type="text/css"
          href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"/>

    <script src="lib/easy-button.js" type="text/javascript"></script>

    <script src="lib/Leaflet.Editable.js"></script>


    <script src="lib/proj4-compressed.js"></script>
    <script src="lib/proj4leaflet.js"></script>


    <script src="../dist/Leaflet-WFST.src.js"></script>
    <title></title>
    <style>
        html, body, #map {
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>
</head>
<body>
<div id="map"></div>
<script>
    var map = L.map('map', {editable: true}).setView([0, 0], 2);

    // add an OpenStreetMap tile layer
    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    L.WFS.Transaction.include(MultiEditableMixin);

    var wfst = new L.WFS.Transaction({
        url: 'http://isogd:8082/geoserver/ows',
        typeNS: 'isogd',
        typeName: 'water_polygon',
        crs: L.CRS.EPSG4326,
        geometryField: 'ogr_geometry',
        style: {
            color: 'blue',
            weight: 2
        },
        requestParams: {
            maxFeatures: 10
        }
    }).addTo(map)
            .once('load', function () {
                map.fitBounds(wfst);
            });

    var editingFeature;

    map.on('editable:created', function (e) {

        if (editingFeature) {
            editingFeature.disableEdit();
        }
        editingFeature = e.layer;

        wfst.addLayer(e.layer);
    });

    map.on('editable:editing', function (e) {
        wfst.editLayer(e.layer);
    });

    L.easyButton('fa-crosshairs', function () {
        map.editTools.startPolygon();
    }, 'Create new');

    var switchEdit = function (enable) {
        var editClick = function (e) {
            if (e.layer === editingFeature) return;

            if (editingFeature) {
                editingFeature.disableEdit();
            }

            editingFeature = e.layer;

            if (editingFeature.enableEdit) {
                editingFeature.enableEdit();
            }
        };

        if (enable) {
            wfst.on('click', editClick);
        }
        else {
            if (editingFeature) {
                editingFeature.disableEdit();
            }

            wfst.off('click', editClick);
        }
    };

    var deleteClick = function (e) {
        wfst.removeLayer(e.layer);
    };

    L.easyButton('fa-edit', function () {
        switchEdit(true);
        wfst.off('click', deleteClick);
    }, 'Edit');

    L.easyButton('fa-ban', function () {
        switchEdit(false);
        wfst.on('click', deleteClick);
    }, 'Remove');

    L.easyButton('fa-save', function () {
        wfst.save();
    }, 'Save changes');

</script>
</body>
</html>